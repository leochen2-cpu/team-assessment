// Prisma Schema - Unique Code 系统

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

generator client {
  provider = "prisma-client-js"
}

// 评估活动表（管理员创建）
model Assessment {
  id           String   @id @default(uuid())
  teamName     String
  memberCount  Int      // 成员数量
  createdBy    String   // 管理员用户名
  createdAt    DateTime @default(now())
  status       String   @default("ACTIVE")  // ACTIVE, COMPLETED
  
  codes        ParticipantCode[]
  teamReport   TeamReport?
  
  @@map("assessments")
}

// 参与者代码表（每个人一个unique code）
model ParticipantCode {
  id           String   @id @default(uuid())
  code         String   @unique  // 8位随机码
  assessmentId String
  isUsed       Boolean  @default(false)
  name         String?  // 参与者姓名（提交后填写）
  email        String?  // 参与者邮箱（提交后填写）
  responses    String?  // JSON: {"Q1": 4, "Q2": 5, ...}
  scores       String?  // JSON: {dimensions, personalScore, grade}
  submittedAt  DateTime?
  emailSent    Boolean  @default(false)
  emailSentAt  DateTime?
  
  assessment Assessment @relation(fields: [assessmentId], references: [id], onDelete: Cascade)
  
  @@map("participant_codes")
}

// 团队报告表（所有人提交后生成）
model TeamReport {
  id                String   @id @default(uuid())
  assessmentId      String   @unique
  teamScore         Float
  baseScore         Float
  consistencyFactor Float
  penaltyFactor     Float
  standardDeviation Float
  dimensionScores   String   // JSON: {teamConnection: 75, ...}
  participationCount Int
  generatedAt       DateTime @default(now())
  
  assessment Assessment @relation(fields: [assessmentId], references: [id], onDelete: Cascade)
  
  @@map("team_reports")
}
